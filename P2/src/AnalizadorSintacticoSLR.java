import java.util.Stack;

public class AnalizadorSintacticoSLR {
    private AnalizadorLexico al;
    private Stack<Integer> estados;
    private Stack<Integer> reglas;
    public Token token;

    private String[][] actionTable =
    {
        // PARI   PARD   OPAS   PYC     DOSP   ASIG   VAR     REAL   ENTERO   ALGORITMO BLQ    FBLQ   SI     ENTONCES   FSI    MIENTRAS   HACER   ESCRIBIR   ID     NENTERO   NREAL   EOF      -ESTADOS-
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   "d1" ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 0
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "d3" , ""   ,    ""   ,  ""        }, // 1
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  "aceptar" }, // 2
        {  ""   , ""   , ""   , "d4" ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 3
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , "d7" ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 4
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , "r2" ,  ""   , ""   ,   ""   ,    "r2" , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 5
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , "d7" ,  ""   , ""   ,   ""   ,    "d10", ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 6
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "d13", ""   ,    ""   ,  ""        }, // 7
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  "r1"      }, // 8
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , "r3" ,  ""   , ""   ,   ""   ,    "r3" , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 9
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    "d10", ""   , "d14", ""   ,     ""   , "d15",     ""   ,  "d17",     "d20", ""   ,    ""   ,  ""        }, // 10
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , "r4" ,  ""   , ""   ,   ""   ,    "r4" , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "d13", ""   ,    ""   ,  ""        }, // 11
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , "r5" ,  ""   , ""   ,   ""   ,    "r5" , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "r5" , ""   ,    ""   ,  ""        }, // 12
        {  ""   , ""   , ""   , ""   ,  "d22", ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 13
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "d26", "d24",    "d23",  ""        }, // 14
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "d26", "d24",    "d23",  ""        }, // 15
        {  ""   , ""   , ""   , "r11",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r11", ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 16
        {  "d29", ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 17
        {  ""   , ""   , ""   , "r14",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r14", ""   , ""   ,     "r14", ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 18
        {  ""   , ""   , ""   , "d31",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "d30", ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 19
        {  ""   , ""   , ""   , ""   ,  ""   , "d32", ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 20
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , "r6" ,  ""   , ""   ,   ""   ,    "r6" , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "r6" , ""   ,    ""   ,  ""        }, // 21
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  "d33", "d34",   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 22
        {  ""   , "r22", "r22", "r22",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r22", ""   , "r22",     "r22", ""   ,     "r22",  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 23
        {  ""   , "r20", "r20", "r20",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r20", ""   , "r20",     "r20", ""   ,     "r20",  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 24
        {  ""   , "r19", "r19", "r19",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r19", ""   , "r19",     "r19", ""   ,     "r19",  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 25
        {  ""   , "r21", "r21", "r21",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r21", ""   , "r21",     "r21", ""   ,     "r21",  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 26
        {  ""   , ""   , "d36", ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , "d37",     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 27
        {  ""   , ""   , "d36", ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     "d38",  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 28
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "d26", "d24",    "d23",  ""        }, // 29
        {  ""   , ""   , ""   , "r10",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r10", ""   , ""   ,     "r10", ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  "r10"     }, // 30
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    "d10", ""   , "d14", ""   ,     ""   , "d15",     ""   ,  "d17",     "d20", ""   ,    ""   ,  ""        }, // 31
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "d26", "d24",    "d23",  ""        }, // 32
        {  ""   , ""   , ""   , "r8" ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 33
        {  ""   , ""   , ""   , "r9" ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 34
        {  ""   , ""   , ""   , "d42",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 35
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "d26", "d24",    "d23",  ""        }, // 36
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , "d14", ""   ,     ""   , "d15",     ""   ,  "d17",     "d20", ""   ,    ""   ,  ""        }, // 37
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , "d14", ""   ,     ""   , "d15",     ""   ,  "d17",     "d20", ""   ,    ""   ,  ""        }, // 38
        {  ""   , "d46", "d36", ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 39
        {  ""   , ""   , ""   , "r12",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r12", ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 40
        {  ""   , ""   , "d36", "r13",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r13", ""   , ""   ,     "r13", ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 41
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , "r7" ,  ""   , ""   ,   ""   ,    "r7" , ""   , ""   , ""   ,     ""   , ""   ,     ""   ,  ""   ,     "r7" , ""   ,    ""   ,  ""        }, // 42
        {  ""   , "r18", "r18", "r18",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r18", ""   , "r18",     "r18", ""   ,     "r18",  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 43
        {  ""   , ""   , ""   , ""   ,  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , ""   , ""   , ""   ,     "d47", ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 44
        {  ""   , ""   , ""   , "r15",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r15", ""   , ""   ,     "r15", ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 45
        {  ""   , ""   , ""   , "r16",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r16", ""   , ""   ,     "r16", ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""        }, // 46
        {  ""   , ""   , ""   , "r17",  ""   , ""   , ""   ,  ""   , ""   ,   ""   ,    ""   , "r17", ""   , ""   ,     "r17", ""   ,     ""   ,  ""   ,     ""   , ""   ,    ""   ,  ""   }  // 47
    };

    private Integer[][] gotoTable =
    {       // 0    1    2    3   4    5       6       7       8      9     10
            // S   VSP  UNSP  LV  V   TIPO   BLOQUE  SINSTR   INSTR   E   FACTOR      -ESTADOS-
            {  2 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 0
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 1
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 2
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 3
            {  0 , 6 ,  5 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 4
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 5
            {  0 , 0 ,  9 ,   0 , 0 , 0 ,    8 ,     0 ,      0 ,     0 , 0            }, // 6
            {  0 , 0 ,  0 ,   11, 12, 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 7
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 8
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 9
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    18,     19,      16,     0 , 0            }, // 10
            {  0 , 0 ,  0 ,   0 , 21, 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 11
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 12
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 13
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     27, 25           }, // 14
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     28, 25           }, // 15
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 16
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 17
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 18
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 19
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 20
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 21
            {  0 , 0 ,  0 ,   0 , 0 , 35,    0 ,     0 ,      0 ,     0 , 0            }, // 22
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 23
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 24
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 25
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 26
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 27
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 28
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     39, 25           }, // 29
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 30
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    18,     0 ,      40,     0 , 0            }, // 31
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     41, 25           }, // 32
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 33
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 34
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 35
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 43           }, // 36
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    18,     0 ,      44,     0 , 0            }, // 37
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    18,     0 ,      45,     0 , 0            }, // 38
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 39
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 38
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 41
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 42
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 43
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 44
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 45
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }, // 46
            {  0 , 0 ,  0 ,   0 , 0 , 0 ,    0 ,     0 ,      0 ,     0 , 0            }  // 47
    };

    private Integer[] parteIzquierda =
    { // 0  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  21  22 : REGLAS
         0, 0, 1, 1, 2, 3, 3, 4, 5, 5, 6,  7,  7,  8,  8,  8,  8,  8,  9,  9,  10, 10, 10
    };

    private Integer[] logitudParteDerecha =
    { // 0  1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  16  17  18  19  20  21  22 : REGLAS
         1, 5, 1, 2, 2, 1, 2, 4, 1, 1, 3,  1,  3,  3,  1,  4,  4,  5,  3,  1,  1,  1,  1
    };

    public AnalizadorSintacticoSLR(AnalizadorLexico al)
    {
        this.al = al;
        this.estados = new Stack<>();
        this.reglas = new Stack<>();
    }

    public void analizar()
    {
        estados.push(0);
        token = al.siguienteToken();
        boolean finAnalisis = false;

        while(!finAnalisis)
        {
            int s = estados.peek();
            if ((actionTable[s][token.tipo]).charAt(0) == 'd')
            {
                int j = Integer.parseInt(actionTable[s][token.tipo].substring(1, actionTable[s][token.tipo].length()));
                estados.push(j);
                token = al.siguienteToken();
            }
            else if ((actionTable[s][token.tipo]).charAt(0) == 'r')
            {
                Integer k = Integer.parseInt(actionTable[s][token.tipo].substring(1, actionTable[s][token.tipo].length()));
                reglas.push(k);
                for (int i = 1; i <= logitudParteDerecha[k]; i++) estados.pop();
                int p = estados.peek();
                int A = parteIzquierda[k];
                estados.push(gotoTable[p][A]);
            }
            else if (actionTable[s][token.tipo] == "acc")
            {
                finAnalisis = true;
            }
            else
            {
                return;
            }
        }

        while (!reglas.isEmpty())
        {
            System.out.println(" " + reglas.pop().toString());
        }
    }
}
